/*! content-flow v0.0.8 by Anthony Blackshaw <ant@getme.co.uk> (https://github.com/anthonyjb) */
(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},e=[].slice,f=function(a,b){return function(){return a.apply(b,arguments)}};a={dimSnippetDOMElement:function(b,c){var d;if(d=a.getSnippetDOMElement(b,c))return d.classList.remove("cf--highlight-snippet")},dimAllSnippetDOMElements:function(){var a,b,c,d,e;for(d=document.querySelectorAll(".cf--highlight-snippet"),e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.classList.remove("cf--highlight-snippet"));return e},getFlowCls:function(){return a.FlowModel},getFlowDOMelement:function(a){return document.querySelector("[data-cf-flow='"+(a.id||a)+"']")},getFlowIdFromDOMElement:function(a){return a.getAttribute("data-cf-flow")},getSnippetCls:function(b){return a.SnippetModel},getSnippetDOMElement:function(a,b){return document.querySelector("[data-cf-snippet='"+b.id+"']")},getSnippetIdFromDOMElement:function(a){return a.getAttribute("data-cf-snippet")},getSnippetTypeCls:function(b){return a.SnippetTypeModel},highlightSnippetDOMElement:function(b,c){var d;if(d=a.getSnippetDOMElement(b,c))return d.classList.add("cf--highlight-snippet")}},"undefined"!=typeof window&&(window.ContentFlow=a),"undefined"!=typeof module&&module.exports&&(module.exports=a),b=function(b){function c(){c.__super__.constructor.call(this),this._api=null,this._flow=null,this._open=!1,this._draw=new a.DrawUI,this.attach(this._draw),this._flows=new a.FlowsUI,this._draw.attach(this._flows),this._toggle=new a.ToggleUI,this.attach(this._toggle),this._flows.addEventListener("select",function(a){return function(b){return a.flow(b.detail().flow)}}(this))}return d(c,b),c._uiInterfaces={},c.prototype.init=function(b,c,d){var e,f,g,h,i,j;for(null==b&&(b="[data-cf-flow]"),null==c&&(c="data-cf-flow"),null==d&&(d=null),f=ContentTools.EditorApp.get(),this._api=d||new a.BaseAPI,this._domFlows=b,("string"==typeof b||b instanceof String)&&(this._domFlows=document.querySelectorAll(this._domFlows)),g=[],j=this._domFlows,h=0,i=j.length;h<i;h++)e=j[h],g.push(new a.FlowModel(e.getAttribute(c)));if(this._flows.flows(g),this._toggle.addEventListener("on",function(a){return function(b){return a.open()}}(this)),this._toggle.addEventListener("off",function(a){return function(b){return a.close()}}(this)),f.addEventListener("start",function(a){return function(b){return a._toggle.hide()}}(this)),f.addEventListener("stop",function(a){return function(b){return a._toggle.show()}}(this)),this._domFlows.length>0)return this.mount(),this._toggle.show(),this.flow(g[0])},c.prototype.api=function(){return this._api},c.prototype.isOpen=function(){return this._open},c.prototype.close=function(){var a;if(this.dispatchEvent(this.createEvent("close")))return document.body.classList.remove("cf--flow-mgr-open"),this._draw.close(),a=ContentTools.EditorApp.get(),a.syncRegions(),a.domRegions().length?a.ignition().show():void 0},c.prototype.flow=function(b){if(void 0===b)return this._flow;if(this._flow!==b)return this._flow=b,a.FlowMgr.get().loadInterface("list-snippets")},c.prototype.loadInterface=function(){var a,b,c,d;if(c=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],d=new this.constructor._uiInterfaces[c])return d.safeToClose()?this._toggle.enable():this._toggle.disable(),this._draw.children().length>1&&(b=this._draw.children()[1],b.unmount(),this._draw.detach(b)),this._draw.attach(d),d.mount(),d.init.apply(d,a)},c.prototype.mount=function(){var a,b,c,d,e;for(this._domElement=this.constructor.createDiv(["cf-flow-mgr"]),document.body.insertBefore(this._domElement,null),this._addDOMEventListeners(),d=this.children(),e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.mount());return e},c.prototype.open=function(){if(this.dispatchEvent(this.createEvent("open")))return document.body.classList.add("cf--flow-mgr-open"),ContentTools.EditorApp.get().ignition().hide(),this._draw.open()},c.prototype.unmount=function(){if(this.isMounted())return this._domElement.parentNode.removeChild(this._domElement),this._removeDOMEventListeners(),this._draw=null,this._flowSelect=null,this._toggle=null},c.registerInterface=function(a,b){return this._uiInterfaces[a]=b},c}(ContentTools.ComponentUI),a.FlowMgr=function(){function c(){}var d;return d=null,c.get=function(){var b;return b=a.FlowMgr.getCls(),null!=d?d:d=new b},c.getCls=function(){return b},c}(),a.BaseAPI=function(){function a(a,b){null==a&&(a="/"),null==b&&(b={}),this.baseURL=a,this.baseParams=b}return a.prototype.getGlobalSnippets=function(a){return this._callEndpoint("GET","global-snippets",{flow:a.id})},a.prototype.getSnippets=function(a){return this._callEndpoint("GET","snippets",{flow:a.id})},a.prototype.getSnippetTypes=function(a){return this._callEndpoint("GET","snippet-types",{flow:a.id})},a.prototype.getSnippetSettingsForm=function(a,b){return this._callEndpoint("GET","snippet-settings",{flow:a.id,snippet:b.id})},a.prototype.addSnippet=function(a,b){return this._callEndpoint("POST","add-snippet",{flow:a.id,snippet_type:b.id})},a.prototype.addGlobalSnippet=function(a,b){return this._callEndpoint("POST","add-global-snippet",{flow:a.id,global_snippet:b.globalId})},a.prototype.changeSnippetScope=function(a,b,c,d){return null==d&&(d=null),this._callEndpoint("POST","change-snippet-scope",{flow:a.id,snippet:b.id,scope:c,label:d})},a.prototype.updateSnippetSettings=function(a,b,c){var d,e,f;e={flow:a.id,snippet:b.id};for(d in c)f=c[d],e[d]=f;return this._callEndpoint("POST","update-snippet-settings",e)},a.prototype.deleteSnippet=function(a,b){return this._callEndpoint("POST","delete-snippet",{flow:a.id,snippet:b.id})},a.prototype.orderSnippets=function(a,b){var c;return this._callEndpoint("POST","order-snippets",{flow:a.id,snippets:function(){var a,d,e;for(e=[],a=0,d=b.length;a<d;a++)c=b[a],e.push(c.id);return e}()})},a.prototype._callEndpoint=function(a,b,c){var d,e,f,g,h,i,j;null==c&&(c={}),i=new XMLHttpRequest,d=null,g="",j=this.baseParams;for(e in j)h=j[e],void 0===c[e]&&(c[e]=h);switch(a.toLowerCase()){case"get":f=Object.keys(c).map(function(a){return[a,c[a]].map(encodeURIComponent).join("=")}),g="?"+f.join("&")+"&_="+Date.now();break;case"delete":case"post":case"post":d=new FormData;for(e in c)h=c[e],d.append(e,h)}return i.open(a,""+this.baseURL+b+g),i.send(d),i},a}(),a.FlowModel=function(){function a(a,b){null==b&&(b=[]),this.id=a,this.snippetTypes=b}return a.prototype.getSnippetTypeById=function(a){var b,c,d,e;for(e=this.snippetTypes,c=0,d=e.length;c<d;c++)if(b=e[c],a===b.id)return b},a}(),a.SnippetModel=function(){function b(a,b,c,d,e,f){null==c&&(c="local"),null==d&&(d={}),null==e&&(e=null),null==f&&(f=null),this.id=a,this.type=b,this.scope=c,this.settings=d,this.globalId=e,this.globalLabel=f}return b.fromJSONType=function(b,c){var d;return d=a.getSnippetTypeCls(b),new a.SnippetModel(c.id,d.fromJSONType(b,c.type),c.scope,c.settings,c.global_id,c.global_label)},b}(),a.SnippetTypeModel=function(){function b(a,b,c){null==c&&(c=null),this.id=a,this.label=b,this.imageURL=c}return b.prototype.toSnippet=function(){return new a.SnippetModel("",this)},b.fromJSONType=function(b,c){return new a.SnippetTypeModel(c.id,c.label,c.image_url)},b}(),a.DrawUI=function(a){function b(){b.__super__.constructor.call(this),this._state="closed"}return d(b,a),b.prototype.open=function(){if(this.dispatchEvent(this.createEvent("open")))return this.state("open")},b.prototype.close=function(){if(this.dispatchEvent(this.createEvent("close")))return this.state("closed")},b.prototype.mount=function(){var a,c,d,e,f;for(b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-draw","ct-draw--closed"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),e=this.children(),f=[],c=0,d=e.length;c<d;c++)a=e[c],f.push(a.mount());return f},b.prototype.state=function(a){if(void 0===a)return a;if(this.state!==a&&this.dispatchEvent(this.createEvent("statechange",{state:a})))return this._state=a,this.isMounted()?(this.removeCSSClass("ct-draw--open"),this.removeCSSClass("ct-draw--closed"),"open"===this._state?this.addCSSClass("ct-draw--open"):this.addCSSClass("ct-draw--closed")):void 0},b}(ContentTools.ComponentUI),a.FieldUI=function(b){function c(a,b,d,e){c.__super__.constructor.call(this),this._name=a,this._label=b,this._required=d,this._initialValue=e}return d(c,b),c.prototype.name=function(){return this._name},c.prototype.label=function(){return this._label},c.prototype.required=function(){return this._required},c.prototype.initialValue=function(){return this._initialValue},c.prototype.errors=function(a){var b,c,d,e,f,g,h;if(!this.isMounted())throw Error("Cannot set error for unmounted field");if(void 0===a){for(a=[],h=this._domErrors.querySelector(".ct-field__error"),d=0,f=h.length;d<f;d++)b=h[d],a.push(b.textContent);return a}if(this._domErrors.innerHTML="",this._domErrors.classList.add("ct-field-errors__empty"),a){for(e=0,g=a.length;e<g;e++)c=a[e],b=this.constructor.createDiv(["ct-field__error"]),b.textContent=ContentEdit._(c),this._domErrors.appendChild(b);return this._domErrors.classList.remove("ct-field-errors__empty")}},c.prototype.mount=function(){return c.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-field",this._required?"ct-field--required":"ct-field--optional"]),this._domLabel=document.createElement("label"),this._domLabel.classList.add("ct-field__label"),this._domLabel.setAttribute("for",this._name),this._domLabel.textContent=ContentEdit._(this._label),this._domElement.appendChild(this._domLabel),this.mount_input(),this._domErrors=this.constructor.createDiv(["ct-field_errors","ct-field_errors__empty"]),this._domElement.appendChild(this._domErrors),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},c.prototype.mount_input=function(){},c.prototype.value=function(a){if(!this.isMounted())throw Error("Cannot set value for unmounted field");return void 0===a?this._domInput.value:this._domInput.value=a},c.prototype.unmount=function(){return c.__super__.unmount.call(this),this._domErrors=null,this._domInput=null,this._domLabel=null},c.fromJSONType=function(b){switch(b.type){case"boolean":return new a.BooleanFieldUI(b.name,b.label,b.required,b.value);case"select":return new a.SelectFieldUI(b.name,b.label,b.required,b.value,b.choices)}return new a.TextFieldUI(b.name,b.label,b.required,b.value)},c}(ContentTools.ComponentUI),a.BooleanFieldUI=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.mount_input=function(){return this._domInput=document.createElement("input"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--boolean"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),this._domInput.setAttribute("type","checkbox"),this._initialValue&&this._domInput.setAttribute("checked",!0),this._domElement.appendChild(this._domInput)},b.prototype.value=function(a){if(!this.isMounted())throw Error("Cannot set value for unmounted field");return void 0===a?this._domInput.checked?this.name:"":(this._domInput.removeAttribute("checked"),a?this._domInput.setAttribute("checked",!0):void 0)},b}(a.FieldUI),a.SelectFieldUI=function(a){function b(a,c,d,e,f){b.__super__.constructor.call(this,a,c,d,e),this._choices=f}return d(b,a),b.prototype.choices=function(){return this.choices},b.prototype.mount_input=function(){var a,b,c,d,e;for(this._domInput=document.createElement("select"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--select"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),e=this._choices,c=0,d=e.length;c<d;c++)a=e[c],b=document.createElement("option"),b.setAttribute("value",a[0]),b.textContent=ContentEdit._(a[1]),this._initialValue===a[0]&&b.setAttribute("selected",!0),this._domInput.appendChild(b);return this._domElement.appendChild(this._domInput)},b}(a.FieldUI),a.TextFieldUI=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.mount_input=function(){return this._domInput=document.createElement("input"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--text"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),this._domInput.setAttribute("type","text"),this._domInput.setAttribute("value",this._initialValue?this._initialValue:""),this._domElement.appendChild(this._domInput)},b}(a.FieldUI),a.FlowsUI=function(a){function b(a){null==a&&(a=[]),b.__super__.constructor.call(this),this._flows=a}return d(b,a),b.prototype.domSelect=function(){return this._domSelect},b.prototype.flows=function(a){var b,c,d,e,f,g;if(void 0===a)return c;if(JSON.stringify(this._flows)!==JSON.stringify(a)&&(this._flows=a,this.isMounted())){for(;this._domSelect.options.length>0;)this._domSelect.remove(0);for(f=this._flows,g=[],d=0,e=f.length;d<e;d++)c=f[d],b=document.createElement("option"),b.setAttribute("value",c.id),b.textContent=c.id,g.push(this._domSelect.appendChild(b));return g}},b.prototype.mount=function(){var a,c,d,e,f;for(b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-flows"]),this._domSelect=document.createElement("select"),this._domSelect.classList.add("ct-flows__select"),this._domSelect.setAttribute("name","flows"),f=this._flows,d=0,e=f.length;d<e;d++)c=f[d],a=document.createElement("option"),a.setAttribute("value",c.id),a.textContent=c.id,this._domSelect.appendChild(a);return this._domElement.appendChild(this._domSelect),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},b.prototype.unmount=function(){return b.__super__.unmount.call(this),this._domSelect=null},b.prototype._addDOMEventListeners=function(){return this._domSelect.addEventListener("change",function(a){return function(b){var c,d,e,f,g,h;for(d=a._domSelect.value,g=a._flows,h=[],e=0,f=g.length;e<f;e++)c=g[e],c.id===d?h.push(a.dispatchEvent(a.createEvent("select",{flow:c}))):h.push(void 0);return h}}(this))},b}(ContentTools.ComponentUI),a.InlayUI=function(b){function c(b){c.__super__.constructor.call(this),this._header=new a.InlayHeaderUI(b),this.attach(this._header),this._body=new a.InlayBodyUI,this.attach(this._body)}return d(c,b),c.prototype.body=function(){return this._body},c.prototype.header=function(){return this._header},c.prototype.mount=function(){return c.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._header.mount(),this._body.mount()},c}(ContentTools.ComponentUI),a.InlayBodyUI=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.mount=function(){var a,c,d,e,f;for(b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__body"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),e=this.children(),f=[],c=0,d=e.length;c<d;c++)a=e[c],f.push(a.mount());return f},b}(ContentTools.ComponentUI),a.InlayHeaderToolsUI=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.mount=function(){var a,c,d,e,f;for(b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__tools"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),e=this.children(),f=[],c=0,d=e.length;c<d;c++)a=e[c],f.push(a.mount());return f},b}(ContentTools.ComponentUI),a.InlayHeaderUI=function(b){function c(b){c.__super__.constructor.call(this),this._heading=b,this._tools=new a.InlayHeaderToolsUI,this.attach(this._tools)}return d(c,b),c.prototype.tools=function(){return this._tools},c.prototype.heading=function(a){return void 0===a?this._heading:(this._heading=a,this.isMounted()?this._domHeading.textContent=ContentEdit._(a):void 0)},c.prototype.mount=function(){return c.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__header"]),this._domHeading=this.constructor.createDiv(["ct-inlay__heading"]),this._domHeading.textContent=ContentEdit._(this._heading),this._domElement.appendChild(this._domHeading),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._tools.mount()},c.prototype.unmount=function(){return c.__super__.unmount.call(this),this._domHeading=null},c}(ContentTools.ComponentUI),a.InlayNoteUI=function(a){function b(a){b.__super__.constructor.call(this),this._content=a}return d(b,a),b.prototype.content=function(a){return void 0===a?this._content:(this._content=a,this.isMounted()?this._domElement.innerHTML=a:void 0)},b.prototype.mount=function(){return b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay-note"]),this._domElement.innerHTML=this._content,this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},b}(ContentTools.ComponentUI),a.InlaySectionUI=function(a){function b(a){b.__super__.constructor.call(this),this._heading=a}return d(b,a),b.prototype.heading=function(a){return void 0===a?this._heading:(this._heading=a,this.isMounted()?this._domHeading.textContent=ContentEdit._(a):void 0)},b.prototype.mount=function(){var a,c,d,e,f;for(b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay-section"]),this._domHeading=this.constructor.createDiv(["ct-inlay-section__heading"]),this._domHeading.textContent=ContentEdit._(this._heading),this._domElement.appendChild(this._domHeading),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),e=this.children(),f=[],c=0,d=e.length;c<d;c++)a=e[c],f.push(a.mount());return f},b.prototype.unmount=function(){return b.__super__.unmount.call(this),this._domHeading=null},b}(ContentTools.ComponentUI),a.InlayToolUI=function(a){function b(a,c){b.__super__.constructor.call(this),this._toolName=a,this._tooltip=c}return d(b,a),b.prototype.toolName=function(){return this._toolName},b.prototype.tooltip=function(){return this._tooltip},b.prototype.mount=function(){return b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__tool","ct-inlay-tool","ct-inlay-tool--"+this._toolName]),this._domElement.setAttribute("data-ct-tooltip",ContentEdit._(this._tooltip)),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},b.prototype._addDOMEventListeners=function(){return b.__super__._addDOMEventListeners.call(this),this._domElement.addEventListener("click",function(a){return function(b){return a.dispatchEvent(a.createEvent("click"))}}(this))},b}(ContentTools.ComponentUI),a.SnippetUI=function(a){function b(a,c){b.__super__.constructor.call(this),this._snippet=a,this._behaviour=c}return d(b,a),b.prototype.mount=function(){var a;return b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-snippet","ct-snippet--behaviour-"+this._behaviour,"ct-snippet--scope-"+this._snippet.scope]),this._domElement.setAttribute("data-snippet-id",this._snippet.id),this._domPreview=this.constructor.createDiv(["ct-snippet__preview"]),this._snippet.type.imageURL&&(a="url("+this._snippet.type.imageURL+")",this._domPreview.style.backgroundImage=a),this._domElement.appendChild(this._domPreview),this._domLabel=this.constructor.createDiv(["ct-snippet__label"]),this._snippet.globalLabel?this._domLabel.textContent=this._snippet.globalLabel:this._domLabel.textContent=this._snippet.type.label,this._domElement.appendChild(this._domLabel),"manage"===this._behaviour&&(this._domTools=this.constructor.createDiv(["ct-snippet__tools"]),this._domSettingsTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--settings"]),this._domSettingsTool.setAttribute("data-ct-tooltip",ContentEdit._("Settings")),this._domTools.appendChild(this._domSettingsTool),this._domScopeTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--scope"]),this._domScopeTool.setAttribute("data-ct-tooltip",ContentEdit._("Scope")),this._domTools.appendChild(this._domScopeTool),this._domDeleteTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--delete"]),this._domDeleteTool.setAttribute("data-ct-tooltip",ContentEdit._("Delete")),this._domTools.appendChild(this._domDeleteTool),this._domElement.appendChild(this._domTools)),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},b.prototype._addDOMEventListeners=function(){return b.__super__._addDOMEventListeners.call(this),this._domElement.addEventListener("mouseover",function(a){return function(b){return a.dispatchEvent(a.createEvent("over",{snippet:a._snippet}))}}(this)),this._domElement.addEventListener("mouseout",function(a){return function(b){return a.dispatchEvent(a.createEvent("out",{snippet:a._snippet}))}}(this)),"manage"===this._behaviour?(this._domSettingsTool.addEventListener("click",function(a){return function(b){return a.dispatchEvent(a.createEvent("settings",{snippet:a._snippet}))}}(this)),this._domScopeTool.addEventListener("click",function(a){return function(b){return a.dispatchEvent(a.createEvent("scope",{snippet:a._snippet}))}}(this)),this._domDeleteTool.addEventListener("click",function(a){return function(b){return a.dispatchEvent(a.createEvent("delete",{snippet:a._snippet}))}}(this))):"pick"===this._behaviour?this._domElement.addEventListener("click",function(a){return function(b){return a.dispatchEvent(a.createEvent("pick",{snippet:a._snippet}))}}(this)):void 0},b}(ContentTools.ComponentUI),a.ToggleUI=function(a){function b(){b.__super__.constructor.call(this),this._state="off",this._enabled=!0}return d(b,a),b.prototype.enabled=function(){return this._enabled},b.prototype.disable=function(){if(this.dispatchEvent(this.createEvent("disable"))&&(this._enabled=!1,this.isMounted()))return this.addCSSClass("ct-toggle--disabled")},b.prototype.enable=function(){if(this.dispatchEvent(this.createEvent("enable"))&&(this._enabled=!0,this.isMounted()))return this.removeCSSClass("ct-toggle--disabled")},b.prototype.mount=function(){return b.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-toggle","ct-toggle--off"]),this._domOff=this.constructor.createDiv(["ct-toggle__button","ct-toggle__button--off"]),this._domElement.appendChild(this._domOff),this._domOn=this.constructor.createDiv(["ct-toggle__button","ct-toggle__button--on"]),this._domElement.appendChild(this._domOn),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},b.prototype.off=function(){if(this.dispatchEvent(this.createEvent("off")))return this.state("off")},b.prototype.on=function(){if(this.dispatchEvent(this.createEvent("on")))return this.state("on")},b.prototype.state=function(a){if(void 0===a)return a;if(this.state!==a&&this.dispatchEvent(this.createEvent("statechange",{state:a})))return this._state=a,this.isMounted()?(this.removeCSSClass("ct-toggle--off"),this.removeCSSClass("ct-toggle--on"),"on"===this._state?this.addCSSClass("ct-toggle--on"):this.addCSSClass("ct-toggle--off")):void 0},b.prototype.toggle=function(){return"on"===this._state?this.off():this.on()},b.prototype.unmount=function(){return b.__super__.unmount.call(this),this._domOn=null,this._domOff=null},b.prototype._addDOMEventListeners=function(){return b.__super__._addDOMEventListeners.call(this),this._domOff.addEventListener("click",function(a){return function(b){if(b.preventDefault(),a._enabled)return a.off()}}(this)),this._domOn.addEventListener("click",function(a){return function(b){if(b.preventDefault(),a._enabled)return a.on()}}(this))},b}(ContentTools.WidgetUI),a.InterfaceUI=function(a){function b(a){b.__super__.constructor.call(this,a)}return d(b,a),b.prototype.init=function(){},b.prototype.safeToClose=function(){return!1},b}(a.InlayUI),a.AddSnippetUI=function(b){function c(){c.__super__.constructor.call(this,"Add"),this._tools={cancel:new a.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.cancel),this._tools.cancel.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("list-snippets")}}())}return d(c,b),c.prototype.init=function(){var b,d;return c.__super__.init.call(this),b=a.FlowMgr.get(),d=b.api().getSnippetTypes(b.flow()),d.addEventListener("load",function(c){return function(e){var f,g,h,i,j,k,l,m,n,o,p,q;for(g=a.FlowMgr.get().flow(),h=JSON.parse(e.target.responseText).payload,p=c._body.children,l=0,n=p.length;l<n;l++)f=p[l],c._body.detach(f);for(c._local=new a.InlaySectionUI("Local scope"),q=h.snippet_types,m=0,o=q.length;m<o;m++)j=q[m],i=a.SnippetTypeModel.fromJSONType(g,j),k=new a.SnippetUI(i.toSnippet(),"pick"),c._local.attach(k),k.addEventListener("pick",function(c){return b=a.FlowMgr.get(),d=b.api().addSnippet(b.flow(),c.detail().snippet.type),d.addEventListener("load",function(b){return function(b){var c,d;return g=a.FlowMgr.get().flow(),h=JSON.parse(b.target.responseText).payload,d=document.createElement("div"),d.innerHTML=h.html,d=d.children[0],c=a.getFlowDOMelement(g),c.appendChild(d),a.FlowMgr.get().loadInterface("list-snippets")}}())});return c._body.attach(c._local),d=b.api().getGlobalSnippets(b.flow()),d.addEventListener("load",function(e){var f,i,j,l,m,n;for(h=JSON.parse(e.target.responseText).payload,g=a.FlowMgr.get().flow(),i=a.getSnippetCls(g),c._global=new a.InlaySectionUI("Global scope"),n=h.snippets,l=0,m=n.length;l<m;l++)j=n[l],f=i.fromJSONType(g,j),k=new a.SnippetUI(f,"pick"),c._global.attach(k),k.addEventListener("pick",function(c){return b=a.FlowMgr.get(),d=b.api().addGlobalSnippet(b.flow(),c.detail().snippet),d.addEventListener("load",function(b){return function(b){var c,d;return g=a.FlowMgr.get().flow(),h=JSON.parse(b.target.responseText).payload,d=document.createElement("div"),d.innerHTML=h.html,d=d.children[0],c=a.getFlowDOMelement(g),c.appendChild(d),a.FlowMgr.get().loadInterface("list-snippets")}}())});return c._global.children().length>0&&c._body.attach(c._global),c._body.unmount(),c._body.mount()})}}(this))},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("add-snippet",a.AddSnippetUI),a.ListSnippetsUI=function(b){function c(){c.__super__.constructor.call(this,"Snippets"),this._tools={order:new a.InlayToolUI("order","Order",!0),add:new a.InlayToolUI("add","Add",!0)},this._header.tools().attach(this._tools.order),this._header.tools().attach(this._tools.add),this._tools.order.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("order-snippets")}}()),this._tools.add.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("add-snippet")}}())}return d(c,b),c.prototype.init=function(){var b,d;return c.__super__.init.call(this),a.dimAllSnippetDOMElements(),b=a.FlowMgr.get(),d=b.api().getSnippets(b.flow()),d.addEventListener("load",function(c){return function(e){var f,g,h,i,j,k,l,m,n,o,p,q,r;for(h=JSON.parse(e.target.responseText).payload,q=c._body.children,m=0,o=q.length;m<o;m++)f=q[m],c._body.detach(f);for(g=a.FlowMgr.get().flow(),j=a.getSnippetCls(g),r=h.snippets,n=0,p=r.length;n<p;n++)k=r[n],i=j.fromJSONType(g,k),l=new a.SnippetUI(i,"manage"),c._body.attach(l),l.addEventListener("over",function(b){return a.highlightSnippetDOMElement(a.FlowMgr.get().flow(),b.detail().snippet)}),l.addEventListener("out",function(b){return a.dimSnippetDOMElement(a.FlowMgr.get().flow(),b.detail().snippet)}),l.addEventListener("settings",function(b){return a.FlowMgr.get().loadInterface("snippet-settings",b.detail().snippet)}),l.addEventListener("scope",function(b){var c;return c="local","local"===b.detail().snippet.scope&&(c="global"),a.FlowMgr.get().loadInterface("make-snippet-"+c,b.detail().snippet)}),l.addEventListener("delete",function(c){var e,f;if(e=ContentEdit._("Are you sure you want to delete this snippet?"),confirm(e))return b=a.FlowMgr.get(),d=b.api().deleteSnippet(b.flow(),c.detail().snippet),f=function(b,c){return function(d){var e;return e=a.getSnippetDOMElement(b,c),e.remove(),a.FlowMgr.get().loadInterface("list-snippets")}},d.addEventListener("load",f(b.flow(),c.detail().snippet))});return c._body.unmount(),c._body.mount()}}(this))},c.prototype.safeToClose=function(){return!0},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("list-snippets",a.ListSnippetsUI),a.MakeSnippetGlobalUI=function(b){function c(){c.__super__.constructor.call(this,"Make global"),this._tools={confirm:new a.InlayToolUI("confirm","Confirm",!0),cancel:new a.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(b){return function(c){var d,e;return d=a.FlowMgr.get(),e=d.api().changeSnippetScope(d.flow(),b._snippet,"global",b._labelField.value()),e.addEventListener("load",function(c){var d;return d=JSON.parse(c.target.responseText),"success"===d.status?a.FlowMgr.get().loadInterface("list-snippets"):b._labelField.errors([d.payload.errors.label])})}}(this)),this._tools.cancel.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("list-snippets")}}())}return d(c,b),c.prototype.init=function(b){var d;return c.__super__.init.call(this),this._snippet=b,this._labelField=new a.TextFieldUI("label","Label",!0),this._body.attach(this._labelField),d=new a.InlayNoteUI(ContentEdit._("Once you make a snippet global it can be inserted into other pages\nand changes made to the snippet&apos;s content or settings will be\napplied to all instances of the snippet.")),this._body.attach(d),this._body.unmount(),this._body.mount()},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("make-snippet-global",a.MakeSnippetGlobalUI),a.MakeSnippetLocaUI=function(b){function c(){c.__super__.constructor.call(this,"Make local"),this._tools={confirm:new a.InlayToolUI("confirm","Confirm",!0),cancel:new a.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(b){return function(c){var d,e;return d=a.FlowMgr.get(),e=d.api().changeSnippetScope(d.flow(),b._snippet,"local"),e.addEventListener("load",function(b){return a.FlowMgr.get().loadInterface("list-snippets")})}}(this)),this._tools.cancel.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("list-snippets")}}())}return d(c,b),c.prototype.init=function(b){var d;return c.__super__.init.call(this),this._snippet=b,d=new a.InlayNoteUI(ContentEdit._("This action replaces the global snippet within the page with a\nlocal version of the snippet. Changes to local snippets are only\napplied to that instance of the snippet.")),this._body.attach(d),this._body.unmount(),this._body.mount()},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("make-snippet-local",a.MakeSnippetLocaUI),a.OrderSnippetsUI=function(b){function c(){this._grab=f(this._grab,this),this._drop=f(this._drop,this),this._drag=f(this._drag,this),c.__super__.constructor.call(this,"Order"),this._tools={confirm:new a.InlayToolUI("confirm","Confirm",!0),cancel:new a.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._grabbed=null,this._grabbedHelper=null,this._grabbedOffset=null,document.addEventListener("mousedown",this._grab),document.addEventListener("mousemove",this._drag),document.addEventListener("mouseup",this._drop),this._tools.confirm.addEventListener("click",function(b){return function(c){var d,e;return d=a.FlowMgr.get(),e=d.api().orderSnippets(d.flow(),b._newSnippetOrder),e.addEventListener("load",function(b){return a.FlowMgr.get().loadInterface("list-snippets")})}}(this)),this._tools.cancel.addEventListener("click",function(b){return function(c){
return b._orderSnippetsOnPage(b._originalSnippetOrder),a.FlowMgr.get().loadInterface("list-snippets")}}(this))}return d(c,b),c.prototype.init=function(){var b,d;return c.__super__.init.call(this),b=a.FlowMgr.get(),d=b.api().getSnippets(b.flow()),d.addEventListener("load",function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o;for(b._snippets={},b._originalSnippetOrder=[],b._newSnippetOrder=[],f=JSON.parse(c.target.responseText).payload,n=b._body.children,j=0,l=n.length;j<l;j++)d=n[j],b._body.detach(d);for(e=a.FlowMgr.get().flow(),h=a.getSnippetCls(e),o=f.snippets,k=0,m=o.length;k<m;k++)i=o[k],g=h.fromJSONType(e,i),b._snippets[g.id]=g,b._originalSnippetOrder.push(g),b._newSnippetOrder.push(g),b._body.attach(new a.SnippetUI(g,"order"));return b._body.unmount(),b._body.mount()}}(this))},c.prototype.unmount=function(){return c.__super__.unmount.call(this),document.removeEventListener("mousedown",this._grab),document.removeEventListener("mousemove",this._drag),document.removeEventListener("mouseup",this._drop)},c.prototype._drag=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(this._grabbed){for(h=this._getEventPos(a),f=[window.pageXOffset,window.pageYOffset],e=f[0]+h[0]-this._grabbedOffset[0]+"px",this._grabbedHelper.style.left=e,k=f[1]+h[1]-this._grabbedOffset[1]+"px",this._grabbedHelper.style.top=k,j=document.elementFromPoint(h[0],h[1]),d=null,n=this._body.children(),l=0,m=n.length;l<m;l++)if(b=n[l],(c=b.domElement())!==this._grabbed&&c.contains(j)){d=c;break}if(d)return i=d.getBoundingClientRect(),g=[h[0]-i.left,h[1]-i.top],this._body.domElement().removeChild(this._grabbed),g[1]>=i.height/2&&(d=d.nextElementSibling),this._body.domElement().insertBefore(this._grabbed,d)}},c.prototype._drop=function(a){var b,c,d,e,f;if(this._grabbed){for(this._grabbed.classList.remove("ct-snippet--ghost"),this._grabbed=null,this._grabbedOffset=null,document.body.removeChild(this._grabbedHelper),this._grabbedHelper=null,this._body.domElement().classList.remove("ct-inlay__body--sorting"),this._newSnippetOrder=[],f=this._body.domElement().childNodes,d=0,e=f.length;d<e;d++)b=f[d],1===b.nodeType&&(c=b.dataset.snippetId,this._newSnippetOrder.push(this._snippets[c]));return this._orderSnippetsOnPage(this._newSnippetOrder)}},c.prototype._getEventPos=function(a){return[a.pageX-window.pageXOffset,a.pageY-window.pageYOffset]},c.prototype._grab=function(a){var b,c,d,e,f,g,h,i,j;if("mousedown"!==a.type.toLowerCase()||1===a.which){for(e=null,j=this._body.children(),h=0,i=j.length;h<i;h++)if(b=j[h],d=b.domElement(),d.contains(a.target)){e=d;break}if(e)return this._grabbed=e,f=this._getEventPos(a),g=this._grabbed.getBoundingClientRect(),this._grabbedOffset=[f[0]-g.left,f[1]-g.top],this._grabbedHelper=e.cloneNode(!0),c=document.defaultView.getComputedStyle(e,"").cssText,this._grabbedHelper.style.cssText=c,this._grabbedHelper.style.position="absolute",this._grabbedHelper.style["pointer-events"]="none",this._grabbedHelper.style.left=f[0]-this._grabbedOffset[0]+"px",this._grabbedHelper.style.top=f[1]-this._grabbedOffset[1]+"px",this._grabbedHelper.classList.add("ct-snippet--helper"),document.body.appendChild(this._grabbedHelper),this._grabbed.classList.add("ct-snippet--ghost"),this._body.domElement().classList.add("ct-inlay__body--sorting")}},c.prototype._orderSnippetsOnPage=function(b){var c,d,e,f,g,h,i,j;for(e=a.FlowMgr.get().flow(),j=[],f=h=0,i=b.length;h<i;f=++h)g=b[f],0!==f&&(c=a.getSnippetDOMElement(e,b[f-1]),d=a.getSnippetDOMElement(e,g),c.nextSibling!==d&&(d.parentNode.removeChild(d),j.push(c.parentNode.insertBefore(d,c.nextSibling))));return j},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("order-snippets",a.OrderSnippetsUI),a.SnippetSettingsUI=function(b){function c(){c.__super__.constructor.call(this,"Settings"),this._tools={confirm:new a.InlayToolUI("confirm","Confirm",!0),cancel:new a.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(b){return function(c){var d,e,f,g,h,i;if(!b._fields)return void a.FlowMgr.get().loadInterface("list-snippets");g={},i=b._fields;for(h in i)d=i[h],g[d.name()]=d.value();return e=a.FlowMgr.get(),f=e.api().updateSnippetSettings(e.flow(),b._snippet,g),f.addEventListener("load",function(c){var d,e,f,g,h,i,j,k;if(i=JSON.parse(c.target.responseText),"success"===i.status)return f=a.FlowMgr.get().flow(),h=a.getSnippetDOMElement(f,b._snippet),g=document.createElement("div"),g.innerHTML=i.payload.html,g=g.children[0],h.parentNode.replaceChild(g,h),a.FlowMgr.get().loadInterface("list-snippets");j=i.payload.errors,k=[];for(e in j)d=j[e],b._fields[e]?k.push(b._fields[e].errors(d)):k.push(void 0);return k})}}(this)),this._tools.cancel.addEventListener("click",function(b){return function(b){return a.FlowMgr.get().loadInterface("list-snippets")}}())}return d(c,b),c.prototype.init=function(b){var c,d;return this._snippet=b,c=a.FlowMgr.get(),d=c.api().getSnippetSettingsForm(c.flow(),b),d.addEventListener("load",function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o;if(g=JSON.parse(c.target.responseText).payload,!g.fields)return b._fields=null,a.InlayNoteUI("There are no settings defined for this snippet."),b._body.unmount(),void b._body.mount();for(b._fields={},m=g.fields,i=0,k=m.length;i<k;i++)e=m[i],d=a.FieldUI.fromJSONType(e),b._fields[d.name()]=d,b._body.attach(d);for(b._body.unmount(),b._body.mount(),n=b._snippet.settings,o=[],h=j=0,l=n.length;j<l;h=++j)f=n[h],b._fields[f]?o.push(b._fields[f].value(h)):o.push(void 0);return o}}(this))},c}(a.InterfaceUI),a.FlowMgr.getCls().registerInterface("snippet-settings",a.SnippetSettingsUI)}).call(this);